---
applyTo: "docs/details/api.md"
---

### API Specification Generation Rules (強化版)

-  When instructed with "Create the API specification", always refer to the `prd.md` file to review the requirements and specifications.
-  Based on the contents of `prd.md`, create the necessary API specifications in Markdown format in the `docs/details/api.md` file.
-  The API specification must be written at a level suitable for top-tier engineers, ensuring no omissions or ambiguities.
-  Follow RESTful design principles strictly (resource-oriented URIs, appropriate HTTP methods, clear status codes).
-  For each endpoint, clearly describe:
   - Purpose and usage scenarios
   - Preconditions and assumptions
   - Authentication/authorization requirements (e.g., OAuth, JWT, API key, role-based access)
   - Side effects (data changes, external service calls, etc.)
   - Versioning policy and deprecation handling if applicable
   - Security requirements (CSRF/XSS protection, rate limiting, CORS, etc.)
-  For all parameters (path, query, header, body):
   - Specify type, required/optional, validation rules, constraints, default values, and examples
-  For each endpoint, provide:
   - Request/response examples for both success and all relevant error cases (validation error, unauthorized, not found, etc.)
   - List of possible error codes and error message formats, with explanations
-  If there is an existing API specification, verify that there are no redundancies or contradictions, and add or modify as necessary.
-  All API specification creation and modifications must include the comment "Generated by Copilot".
-  API specifications must use following markdown template:
```markdown
# API設計

## エンドポイント一覧

> (例)
>
> ### ユーザー関連
> - `POST /users` - ユーザー登録
> - `GET /users/{id}` - ユーザー情報取得
> - `PUT /users/{id}` - ユーザー情報更新
> - `DELETE /users/{id}` - ユーザー削除


## エンドポイント詳細

### POST /users

- **目的**: ユーザー登録
- **利用シーン**: 新規ユーザー作成時
- **認証/認可**: なし
- **前提条件**: メールアドレスが未登録であること
- **副作用**: ユーザー情報の新規作成
- **バージョン**: v1
- **セキュリティ**: CSRF対策必須

#### パラメータ
| 名前      | 種類   | 型      | 必須 | バリデーション・制約         | デフォルト | 例           |
|---------|------|--------|-----|------------------------|---------|-------------|
| name    | body | string | ○   | 1-50文字、必須           | なし      | "山田太郎"      |
| email   | body | string | ○   | Email形式、必須           | なし      | "test@example.com" |
| password| body | string | ○   | 8文字以上、英数字混在必須     | なし      | "Passw0rd"    |

#### リクエスト例
```json
{
  "name": "山田太郎",
  "email": "test@example.com",
  "password": "Passw0rd"
}
```

#### レスポンス例（成功）
```json
{
  "id": "string",
  "name": "山田太郎",
  "email": "test@example.com"
}
```

#### レスポンス例（バリデーションエラー）
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "メールアドレスの形式が正しくありません。"
  }
}
```

#### レスポンス例（認可エラー）
```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "認証情報が必要です。"
  }
}
```

#### エラーコード一覧
| コード              | 意味                       |
|-------------------|--------------------------|
| VALIDATION_ERROR  | 入力値が不正              |
| UNAUTHORIZED      | 認証・認可エラー           |
| NOT_FOUND         | リソースが存在しない        |
| INTERNAL_ERROR    | サーバ内部エラー            |

```
